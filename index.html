<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ë‚¨ë“¤ í™˜ê²½ ì •ì²´ì„± ì„±ì¥ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0fdf4; /* Very light green bg */
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 380px;
        }

        /* Custom Range Sliders */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        
        /* 'Before' Slider (Gray) */
        input[type=range].slider-before::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #94a3b8; /* slate-400 */
            cursor: pointer;
            margin-top: -7px; 
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        input[type=range].slider-before::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }

        /* 'After' Slider (Green) */
        input[type=range].slider-after::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 22px;
            width: 22px;
            border-radius: 50%;
            background: #15803d; /* green-700 */
            cursor: pointer;
            margin-top: -9px; 
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        input[type=range].slider-after::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #86efac; /* green-300 */
            border-radius: 2px;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #15803d;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Markdown Styles for AI Content */
        .prose h1, .prose h2, .prose h3 { color: #166534; margin-bottom: 0.5rem; font-weight: 700; }
        .prose p { margin-bottom: 0.8rem; line-height: 1.6; }
        .prose strong { color: #15803d; }
    </style>
</head>
<body class="text-slate-800 relative">

    <!-- API Key Modal -->
    <div id="apiKeyModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
            <h3 class="text-lg font-bold mb-4">Gemini API í‚¤ ì„¤ì •</h3>
            <p class="text-sm text-slate-600 mb-4">AI ìì„œì „ ê¸°ëŠ¥ì„ ìœ„í•´ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <input type="password" id="apiKeyInput" placeholder="API Key ì…ë ¥" class="w-full p-2 border border-slate-300 rounded mb-4">
            <div class="flex justify-end gap-2">
                <button onclick="closeApiKeyModal()" class="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded">ë‹«ê¸°</button>
                <button onclick="saveApiKey()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-green-800 text-white py-8 px-4 shadow-lg sticky top-0 z-40">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold">ì¥ë‚¨ë“¤ í™˜ê²½ ì •ì²´ì„± ì„±ì¥ ê¸°ë¡</h1>
                <p class="text-green-200 text-sm mt-1">ìˆ˜ì—… ì „ê³¼ í›„, ë‚˜ì˜ ë§ˆìŒì´ ì–¼ë§ˆë‚˜ ìëë‚˜ìš”?</p>
            </div>
            <button onclick="openApiKeyModal()" class="bg-green-900 bg-opacity-50 hover:bg-opacity-100 px-3 py-1 rounded text-xs flex items-center gap-1 transition-all">
                <span>âš™ï¸ API Key</span>
            </button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- LEFT: SURVEY (Scrollable) -->
        <div class="lg:col-span-7 space-y-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-green-100">
                <h2 class="text-xl font-bold text-green-800 mb-2">ğŸŒ± ë§ˆìŒì˜ í‚¤ ì¬ê¸°</h2>
                <p class="text-slate-600 text-sm">
                    ì™¼ìª½ì€ <strong>ìˆ˜ì—… ë“£ê¸° ì „(ì˜›ë‚ )</strong>, ì˜¤ë¥¸ìª½ì€ <strong>ìˆ˜ì—… ë“¤ì€ í›„(ì§€ê¸ˆ)</strong>ì˜ ë§ˆìŒì…ë‹ˆë‹¤.<br>
                    ë³€í™”ëœ ë§Œí¼ ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬ì£¼ì„¸ìš”.
                </p>
            </div>

            <form id="eid-survey-form" class="space-y-12 pb-20">
                <!-- Questions injected via JS -->
            </form>
        </div>

        <!-- RIGHT: CHART & AI (Sticky) -->
        <div class="lg:col-span-5 space-y-6">
            <div class="sticky top-28 space-y-6">
                
                <!-- Chart Card -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                    <h3 class="text-center font-bold text-slate-700 mb-4">ë‚˜ì˜ ì„±ì¥ ê·¸ë˜í”„</h3>
                    <div class="flex justify-center gap-4 text-xs mb-2">
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-slate-400"></span>ìˆ˜ì—… ì „</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-green-600"></span>ìˆ˜ì—… í›„</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="growthRadarChart"></canvas>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mt-4 text-center">
                        <div class="bg-slate-100 p-3 rounded-lg">
                            <span class="block text-xs text-slate-500">ìˆ˜ì—… ì „ í‰ê· </span>
                            <span id="avg-before" class="text-xl font-bold text-slate-600">0.0</span>
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <span class="block text-xs text-green-700">ìˆ˜ì—… í›„ í‰ê· </span>
                            <span id="avg-after" class="text-2xl font-bold text-green-700">0.0</span>
                        </div>
                    </div>
                </div>

                <!-- AI Writer Card -->
                <div class="bg-gradient-to-br from-green-50 to-white p-6 rounded-xl shadow-md border border-green-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-green-800">âœ¨ AI ìƒíƒœ ìì„œì „</h3>
                        <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">Gemini Pro</span>
                    </div>
                    <p class="text-xs text-slate-600 mb-4">
                        ë‚˜ì˜ ì„±ì¥ ê¸°ë¡ì„ ë°”íƒ•ìœ¼ë¡œ ì¥ë‚¨ë“¤ì˜ ìƒëª…ë“¤ê³¼ ì–´ìš°ëŸ¬ì§€ëŠ” ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
                    </p>
                    
                    <button id="generateBtn" onclick="generateGrowthStory()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow transition-colors flex items-center justify-center gap-2 group">
                        <span class="group-hover:scale-110 transition-transform">ğŸ“</span>
                        <span>ë‚´ ì´ì•¼ê¸° ë§Œë“¤ê¸°</span>
                    </button>

                    <div id="aiResponseContainer" class="mt-4 hidden bg-white p-5 rounded-lg border border-green-100 text-sm leading-relaxed text-slate-700 max-h-80 overflow-y-auto prose prose-sm">
                        <div id="aiLoading" class="flex flex-col items-center py-4">
                            <div class="loader mb-2"></div>
                            <span class="text-xs text-green-600 animate-pulse">Geminiê°€ ì¥ë‚¨ë“¤ì˜ ë°”ëŒ ì†Œë¦¬ë¥¼ ë“£ê³  ìˆì–´ìš”...</span>
                        </div>
                        <div id="aiResult"></div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // --- DATA ---
        let apiKey = "";
        
        // 4ê°œì˜ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜ëœ 16ë¬¸í•­
        const questions = [
            // PART 1: ì¼ë°˜ì  í™˜ê²½ ì •ì²´ì„±
            { id: 1, text: "ë‚˜ëŠ” ìì—° ì†ì— ìˆì„ ë•Œ ë§ˆìŒì´ í¸ì•ˆí•˜ë‹¤.", category: "connectedness" },
            { id: 2, text: "ë™ë¬¼ì´ë‚˜ ì‹ë¬¼ì´ 'ë‚˜ì™€ ë‹®ì€ ì 'ì´ ë§ë‹¤ê³  ëŠë‚€ë‹¤.", category: "connectedness" },
            { id: 3, text: "ë‚˜ëŠ” ë‚´ê°€ 'ìì—°ì˜ ì¼ë¶€'ë¼ê³  ìƒê°í•œë‹¤.", category: "connectedness" },
            { id: 4, text: "ìì—°ì´ ë‚˜ì˜ ì¹œêµ¬ë‚˜ ì´ì›ƒì²˜ëŸ¼ ëŠê»´ì§„ë‹¤.", category: "connectedness" },
            
            { id: 5, text: "ìì—°ì´ ì•„í”„ë©´ ë‚˜ë„ ë§ˆìŒì´ ì•„í”„ë‹¤.", category: "interdependence" },
            { id: 6, text: "ëˆ„ê°€ ì‹œí‚¤ì§€ ì•Šì•„ë„ ìŠ¤ìŠ¤ë¡œ ìì—°ì„ ë³´í˜¸í•œë‹¤.", category: "interdependence" },
            { id: 7, text: "ìì—°ì´ ê±´ê°•í•´ì•¼ ë‚˜ë„ ê±´ê°•í•˜ë‹¤ê³  ë¯¿ëŠ”ë‹¤.", category: "interdependence" },
            { id: 8, text: "ë‚˜ì˜ ì‘ì€ í–‰ë™ì´ ìì—°ì„ ì§€í‚¨ë‹¤ê³  ë¯¿ëŠ”ë‹¤.", category: "interdependence" },
            
            { id: 9, text: "ë‚˜ëŠ” 'ìì—°ì„ ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒ'ì´ë‹¤.", category: "selfId" },
            { id: 10, text: "ë‹¤ë¥¸ ì¹œêµ¬ë“¤ë³´ë‹¤ í™˜ê²½ ë¬¸ì œì— ê´€ì‹¬ì´ ë§ë‹¤.", category: "selfId" },
            { id: 11, text: "ì–´ë¥¸ì´ ë˜ì–´ì„œë„ ìì—°ê³¼ ê°€ê¹ê²Œ ì§€ë‚´ê³  ì‹¶ë‹¤.", category: "selfId" },
            
            // PART 2: ì¥ë‚¨ë“¤ ì¥ì†Œ ì •ì²´ì„± (ê°•ì¡°)
            { id: 12, text: "ë‚˜ëŠ” 'ì¥ë‚¨ë“¤'ì´ ìš°ë¦¬ ì§‘ì²˜ëŸ¼ ì¹œê·¼í•˜ê²Œ ëŠê»´ì§„ë‹¤.", category: "placeId" },
            { id: 13, text: "ê¸ˆê°œêµ¬ë¦¬ëŠ” ë‚¨ì´ ì•„ë‹ˆë¼ ë‚˜ì˜ ì´ì›ƒì´ë‹¤.", category: "placeId" },
            { id: 14, text: "ì¥ë‚¨ë“¤ì˜ ì—­ì‚¬(ë…¼â†’ê³µì›)ë¥¼ ì•„ëŠ” ê²ƒì€ ì¤‘ìš”í•˜ë‹¤.", category: "placeId" },
            { id: 15, text: "ì¥ë‚¨ë“¤ì€ ë‚˜ì—ê²Œ ìœ„ë¡œê°€ ë˜ëŠ” ì†Œì¤‘í•œ ì¥ì†Œë‹¤.", category: "placeId" },
            { id: 16, text: "ë‚˜ëŠ” 'ì¥ë‚¨ë“¤ê³¼ í•¨ê»˜ ìë¼ëŠ” ì•„ì´'ë‹¤.", category: "placeId" }
        ];

        // ìƒíƒœ ê´€ë¦¬ (Before, After ì ìˆ˜ ì €ì¥)
        const state = {
            scores: {}, // { id: { before: 3, after: 3 } }
            averages: {
                before: { connectedness: 0, interdependence: 0, selfId: 0, placeId: 0 },
                after: { connectedness: 0, interdependence: 0, selfId: 0, placeId: 0 }
            },
            totalAvg: { before: 0, after: 0 }
        };

        // ì´ˆê¸°í™”
        questions.forEach(q => state.scores[q.id] = { before: 3, after: 3 });

        // --- DOM ìƒì„± ---
        function createComparisonElement(q) {
            const container = document.createElement('div');
            container.className = "bg-white p-5 rounded-xl border border-slate-100 hover:shadow-md transition-shadow";
            
            // ì§ˆë¬¸ í…ìŠ¤íŠ¸
            const label = document.createElement('h3');
            label.className = "text-base font-bold text-slate-700 mb-4";
            label.innerHTML = `<span class="text-green-600 mr-1">Q${q.id}.</span> ${q.text}`;
            
            // ë¹„êµ ì˜ì—­ ê·¸ë¦¬ë“œ
            const grid = document.createElement('div');
            grid.className = "grid grid-cols-[1fr_auto_1fr] gap-4 items-center";

            // 1. Before (ì™¼ìª½)
            const leftCol = document.createElement('div');
            leftCol.className = "bg-slate-50 p-3 rounded-lg text-center border border-slate-200";
            leftCol.innerHTML = `<div class="text-xs text-slate-500 mb-2 font-bold">(ì˜›ë‚ ) ìˆ˜ì—… ì „</div>`;
            
            const sliderBefore = document.createElement('input');
            sliderBefore.type = "range";
            sliderBefore.min = "1"; 
            sliderBefore.max = "5"; 
            sliderBefore.value = "3";
            sliderBefore.className = "slider-before mb-2";
            
            const valBefore = document.createElement('div');
            valBefore.className = "text-lg font-bold text-slate-400";
            valBefore.innerText = "3";

            sliderBefore.addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                state.scores[q.id].before = val;
                valBefore.innerText = val;
                valBefore.style.color = val >= 4 ? "#64748b" : "#94a3b8"; // slight darken
                calculate();
            });

            leftCol.appendChild(sliderBefore);
            leftCol.appendChild(valBefore);

            // 2. Arrow (ì¤‘ê°„)
            const arrow = document.createElement('div');
            arrow.className = "text-slate-300 text-xl font-bold";
            arrow.innerText = "â–¶";

            // 3. After (ì˜¤ë¥¸ìª½)
            const rightCol = document.createElement('div');
            rightCol.className = "bg-green-50 p-3 rounded-lg text-center border border-green-200";
            rightCol.innerHTML = `<div class="text-xs text-green-700 mb-2 font-bold">(ì§€ê¸ˆ) ìˆ˜ì—… í›„</div>`;
            
            const sliderAfter = document.createElement('input');
            sliderAfter.type = "range";
            sliderAfter.min = "1"; 
            sliderAfter.max = "5"; 
            sliderAfter.value = "3";
            sliderAfter.className = "slider-after mb-2";
            
            const valAfter = document.createElement('div');
            valAfter.className = "text-lg font-bold text-green-600";
            valAfter.innerText = "3";

            sliderAfter.addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                state.scores[q.id].after = val;
                valAfter.innerText = val;
                // Highlighting high scores
                if(val === 5) { valAfter.innerText = "5 (ë§¤ìš°!)"; valAfter.classList.add("text-green-800"); }
                else { valAfter.innerText = val; valAfter.classList.remove("text-green-800"); }
                calculate();
            });

            rightCol.appendChild(sliderAfter);
            rightCol.appendChild(valAfter);

            grid.appendChild(leftCol);
            grid.appendChild(arrow);
            grid.appendChild(rightCol);

            container.appendChild(label);
            container.appendChild(grid);
            return container;
        }

        function renderForm() {
            const form = document.getElementById('eid-survey-form');
            
            // ì„¹ì…˜ í—¤ë” ì¶”ê°€ í•¨ìˆ˜
            const addHeader = (title, colorClass) => {
                const h = document.createElement('div');
                h.className = `font-bold text-lg ${colorClass} mt-8 mb-4 border-b pb-2`;
                h.innerText = title;
                form.appendChild(h);
            };

            addHeader("PART 1. ìì—°ê³¼ ë‚˜ì˜ ê±°ë¦¬ (ì¼ë°˜)", "text-slate-600");
            questions.slice(0, 11).forEach(q => form.appendChild(createComparisonElement(q)));

            addHeader("PART 2. ì¥ë‚¨ë“¤ê³¼ ë‚˜ì˜ ê±°ë¦¬ (ì¥ì†Œ ì •ì²´ì„±)", "text-green-700");
            questions.slice(11).forEach(q => form.appendChild(createComparisonElement(q)));
        }

        // --- CALCULATION ---
        function calculate() {
            let sums = { 
                before: { connectedness: 0, interdependence: 0, selfId: 0, placeId: 0 },
                after: { connectedness: 0, interdependence: 0, selfId: 0, placeId: 0 }
            };
            let counts = { connectedness: 0, interdependence: 0, selfId: 0, placeId: 0 };
            let totalSum = { before: 0, after: 0 };

            questions.forEach(q => {
                const s = state.scores[q.id];
                const cat = q.category;
                
                sums.before[cat] += s.before;
                sums.after[cat] += s.after;
                counts[cat]++;
                
                totalSum.before += s.before;
                totalSum.after += s.after;
            });

            // í‰ê·  ê³„ì‚°
            ['before', 'after'].forEach(period => {
                state.averages[period].connectedness = (sums[period].connectedness / counts.connectedness).toFixed(1);
                state.averages[period].interdependence = (sums[period].interdependence / counts.interdependence).toFixed(1);
                state.averages[period].selfId = (sums[period].selfId / counts.selfId).toFixed(1);
                state.averages[period].placeId = (sums[period].placeId / counts.placeId).toFixed(1);
                state.totalAvg[period] = (totalSum[period] / questions.length).toFixed(1);
            });

            document.getElementById('avg-before').innerText = state.totalAvg.before;
            document.getElementById('avg-after').innerText = state.totalAvg.after;

            updateChart();
        }

        // --- CHART ---
        let myChart;
        function initChart() {
            const ctx = document.getElementById('growthRadarChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ì •ì„œì  ì—°ê²°ê°', 'ì±…ì„ê°/ìƒí˜¸ì˜ì¡´', 'ìê¸° ì •ì˜', 'ì¥ì†Œ ì •ì²´ì„±(ì¥ë‚¨ë“¤)'],
                    datasets: [
                        {
                            label: 'ìˆ˜ì—… ì „',
                            data: [3, 3, 3, 3],
                            backgroundColor: 'rgba(148, 163, 184, 0.2)', // Slate
                            borderColor: '#94a3b8',
                            borderDash: [5, 5], // ì ì„ 
                            pointBackgroundColor: '#94a3b8',
                            borderWidth: 2
                        },
                        {
                            label: 'ìˆ˜ì—… í›„',
                            data: [3, 3, 3, 3],
                            backgroundColor: 'rgba(21, 128, 61, 0.4)', // Green
                            borderColor: '#15803d',
                            pointBackgroundColor: '#15803d',
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#f1f5f9' },
                            pointLabels: {
                                font: { size: 11, family: "'Noto Sans KR', sans-serif", weight: 'bold' },
                                color: '#334155'
                            },
                            suggestedMin: 1,
                            suggestedMax: 5,
                            ticks: { display: false, stepSize: 1 }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateChart() {
            if (myChart) {
                myChart.data.datasets[0].data = Object.values(state.averages.before);
                myChart.data.datasets[1].data = Object.values(state.averages.after);
                myChart.update();
            }
        }

        // --- GEMINI AI ---
        function openApiKeyModal() { document.getElementById('apiKeyModal').classList.remove('hidden'); }
        function closeApiKeyModal() { document.getElementById('apiKeyModal').classList.add('hidden'); }
        function saveApiKey() {
            const val = document.getElementById('apiKeyInput').value;
            if(val) { apiKey = val; closeApiKeyModal(); alert("API í‚¤ ì €ì¥ ì™„ë£Œ!"); }
        }

        async function generateGrowthStory() {
            if (!apiKey) { alert("API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!"); openApiKeyModal(); return; }

            const container = document.getElementById('aiResponseContainer');
            const loading = document.getElementById('aiLoading');
            const result = document.getElementById('aiResult');
            const btn = document.getElementById('generateBtn');

            container.classList.remove('hidden');
            loading.classList.remove('hidden');
            result.innerHTML = '';
            btn.disabled = true;

            // ë³€í™”ëŸ‰ ê³„ì‚° (ë‹¨ìˆœ ì¶”ì„¸ í™•ì¸ìš©, í”„ë¡¬í”„íŠ¸ì—ì„œ ìˆ«ìëŠ” ìˆ¨ê¹€)
            const diffPlace = (state.averages.after.placeId - state.averages.before.placeId);
            const diffConnect = (state.averages.after.connectedness - state.averages.before.connectedness);

            const prompt = `
                ë‹¹ì‹ ì€ ê·¸ë¦¼ì±… 'ë‚˜ëŠ” ê°•ë¬¼ì²˜ëŸ¼ ë§í•´ìš”'ì˜ ì‘ê°€ì²˜ëŸ¼ ì‹œì ì´ê³  ì•„ë¦„ë‹¤ìš´ ë¬¸ì²´ë¡œ ê¸€ì„ ì“°ëŠ” AIì…ë‹ˆë‹¤.
                ì´ˆë“±í•™êµ 6í•™ë…„ í•™ìƒì´ 12ì£¼ ë™ì•ˆ ì„¸ì¢…ì‹œ 'ì¥ë‚¨ë“¤ í‰ì•¼'ì—ì„œ ìƒíƒœ ìˆ˜ì—…ì„ ë“¤ì—ˆìŠµë‹ˆë‹¤.
                ì•„ë˜ëŠ” ì´ í•™ìƒì˜ ë‚´ë©´ ë³€í™”ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤.

                [ë³€í™” ë°ì´í„° - ì°¸ê³ ë§Œ í•˜ê³  ì ˆëŒ€ ìˆ«ìë¥¼ ì§ì ‘ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”]
                - ìì—°ê³¼ì˜ ê±°ë¦¬: ${diffConnect > 0 ? 'ë” ê°€ê¹Œì›Œì§' : 'ì—¬ì „í•¨'}
                - ì¥ì†Œ(ì¥ë‚¨ë“¤)ì— ëŒ€í•œ ì• ì°©: ${state.averages.after.placeId >= 4 ? 'ë§¤ìš° ê¹Šì–´ì§' : 'ìƒê¸°ê¸° ì‹œì‘í•¨'}
                - ìˆ˜ì—… í›„ ì¥ì†Œ ì •ì²´ì„± ìƒíƒœ: ${state.averages.after.placeId >= 4 ? 'ì¥ë‚¨ë“¤ê³¼ í•˜ë‚˜ê°€ ë¨' : 'ì¥ë‚¨ë“¤ì„ ì•Œì•„ê°€ëŠ” ì¤‘'}

                [ê¸€ì“°ê¸° ê·œì¹™ - ë§¤ìš° ì¤‘ìš”]
                1. **ì ìˆ˜ë‚˜ ìˆ«ìë¥¼ ì ˆëŒ€ ì“°ì§€ ë§ˆì„¸ìš”.** (ì˜ˆ: "3ì ì—ì„œ 5ì ìœ¼ë¡œ ì˜¬ëë‹¤" X) ëŒ€ì‹  ë§ˆìŒì˜ ë³€í™”ë¥¼ ìì—°ë¬¼ì— ë¹—ëŒ€ì–´ í‘œí˜„í•˜ì„¸ìš”.
                2. **ë¬¸ì²´:** "ë‚˜ëŠ” ê°•ë¬¼ì²˜ëŸ¼ ë§í•´ìš”"ì²˜ëŸ¼ ì„œì •ì ì´ê³  ê°ë™ì ì¸ 1ì¸ì¹­ ì‹œì . ë¬¸ì¥ì€ ì§§ê³  ìš¸ë¦¼ ìˆê²Œ.
                3. **í•„ìˆ˜ í¬í•¨ ì†Œì¬:** ì¥ë‚¨ë“¤ì˜ ì¹œêµ¬ë“¤ì¸ **ê¸ˆê°œêµ¬ë¦¬, í‘ë‘ë£¨ë¯¸, ê³ ë¼ë‹ˆ, ê³ ë‹ˆ, ê°ˆëŒ€** ì¤‘ 3ê°€ì§€ ì´ìƒì„ ë°˜ë“œì‹œ ë¹„ìœ ì˜ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.
                4. **ë‚´ìš© íë¦„:**
                   - (ê³¼ê±°) ì‚­ë§‰í•˜ê³  ë¬´ì‹¬í–ˆë˜ ë‚˜ì˜ ë§ˆìŒ (ì˜ˆ: ë©”ë§ˆë¥¸ ë…¼ë°”ë‹¥ ê°™ì•˜ë˜ ë‚˜).
                   - (ë§Œë‚¨) ì¥ë‚¨ë“¤ì—ì„œ ê·¸ ìƒëª…ë“¤ì„ ìì„¸íˆ ë“¤ì—¬ë‹¤ë³´ë˜ ìˆœê°„.
                   - (í˜„ì¬) ì´ì œëŠ” ê·¸ë“¤ì²˜ëŸ¼ ìƒê°í•˜ê³  í–‰ë™í•˜ê²Œ ëœ ë‚˜ì˜ ë‹¤ì§ (ì˜ˆ: ë‚˜ëŠ” ê¸ˆê°œêµ¬ë¦¬ì²˜ëŸ¼ ë…¸ë˜í•´ìš”).
                5. ì œëª©: ë©‹ì§„ ë¹„ìœ ê°€ ë‹´ê¸´ ì œëª©.
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                
                if(data.error) throw new Error(data.error.message);

                const aiText = data.candidates[0].content.parts[0].text;
                result.innerHTML = marked.parse(aiText);

            } catch (e) {
                result.innerHTML = `<p class="text-red-500">ì˜¤ë¥˜ ë°œìƒ: ${e.message}</p>`;
            } finally {
                loading.classList.add('hidden');
                btn.disabled = false;
            }
        }

        // Init
        window.addEventListener('DOMContentLoaded', () => {
            renderForm();
            initChart();
            calculate();
        });
    </script>
</body>
</html>
